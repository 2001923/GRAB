data,
subjData = subjData,
method = "SPACox",
traitType = "time-to-event",  # "binary", "ordinal", "quantitative", "time-to-event"
GenoFile)
objNull = GRAB.NullModel(formula,
data,
subjData = subjData,
method = "SPACox",
traitType = "time-to-event",  # "binary", "ordinal", "quantitative", "time-to-event"
GenoFile = GenoFile)
remove.packages("GRAB", lib="~/R/win-library/4.0")
library(GRAB)
POLMM_data = read.csv(system.file("extdata", "POLMM_data.csv", package = "GRAB"))
formula  = as.factor(outcome) ~ Cova1 + Cova2
data = POLMM_data
subset = NULL
subjData = data$IID
method = "POLMM"
traitType = "ordinal"
control = NULL
GenoFile = system.file("extdata", "example.bed", package = "GRAB")
objNull = GRAB.NullModel(formula,
data,
subjData = subjData,
method = "SPACox",
traitType = "time-to-event",  # "binary", "ordinal", "quantitative", "time-to-event"
GenoFile = GenoFile)
names(objNull)
all(objNull$subjData == objNull$subjGeno)
objNull$Call
POLMM_data = read.csv(system.file("extdata", "POLMM_data.csv", package = "GRAB"))
POLMM_data = POLMM_data[c(1,4,2),]
formula  = as.factor(outcome) ~ Cova1 + Cova2
data = POLMM_data
subset = NULL
subjData = data$IID
method = "POLMM"
traitType = "ordinal"
control = NULL
GenoFile = system.file("extdata", "example.bed", package = "GRAB")
objNull = GRAB.NullModel(formula,
data,
subjData = subjData,
method = "SPACox",
traitType = "time-to-event",  # "binary", "ordinal", "quantitative", "time-to-event"
GenoFile = GenoFile)
all(objNull$subjData == objNull$subjGeno)
POLMM_data = read.csv(system.file("extdata", "POLMM_data.csv", package = "GRAB"), stringsAsFactors = F)
POLMM_data = POLMM_data[c(1,4,2),]
formula  = as.factor(outcome) ~ Cova1 + Cova2
data = POLMM_data
subset = NULL
subjData = data$IID
method = "POLMM"
traitType = "ordinal"
control = NULL
GenoFile = system.file("extdata", "example.bed", package = "GRAB")
objNull = GRAB.NullModel(formula,
data,
subjData = subjData,
method = "SPACox",
traitType = "time-to-event",  # "binary", "ordinal", "quantitative", "time-to-event"
GenoFile = GenoFile)
POLMM_data = read.csv(system.file("extdata", "POLMM_data.csv", package = "GRAB"), stringsAsFactors = F)
POLMM_data = POLMM_data[c(1,4,2),]
POLMM_data
objFormula = GRAB:::handleFormula(formula, data, subset)  # check formula.R for more details
response = objFormula$response
designMat = objFormula$designMat   # note that the intercept column is not included
pos = objFormula$pos
pos
formula
data
handleFormula = function (formula, data, subset)  {
cl <- match.call()
mf <- match.call(expand.dots = FALSE)
m <- match(x = c("formula", "data", "subset"),
table = names(mf), nomatch = 0L)
mf <- mf[c(1L, m)]
mf$drop.unused.levels <- TRUE
mf[[1L]] <- quote(stats::model.frame)
mf <- eval(expr = mf, envir = parent.frame())
mt = attr(x = mf, which = "terms")
x <- model.matrix(object = mt, data = mf)
response = model.response(mf)
pos = as.numeric(names(response))
designMat = model.matrix(object = mt, data = mf)
if(colnames(designMat)[1] == "(Intercept)")
designMat = designMat[,-1,drop=F]
return(list(response = response,
pos = pos,
designMat = designMat))
}
objFormula = handleFormula(formula, data, subset)  # check formula.R for more details
handleFormula = function (formula, data, subset)  {
cl <- match.call()
mf <- match.call(expand.dots = FALSE)
m <- match(x = c("formula", "data", "subset"),
table = names(mf), nomatch = 0L)
mf <- mf[c(1L, m)]
mf$drop.unused.levels <- TRUE
mf[[1L]] <- quote(stats::model.frame)
mf <- eval(expr = mf, envir = parent.frame())
mt = attr(x = mf, which = "terms")
x <- model.matrix(object = mt, data = mf)
response = model.response(mf)
pos = as.numeric(names(response))
designMat = model.matrix(object = mt, data = mf)
print(response)
print(designMat)
if(colnames(designMat)[1] == "(Intercept)")
designMat = designMat[,-1,drop=F]
return(list(response = response,
pos = pos,
designMat = designMat))
}
objFormula = handleFormula(formula, data, subset)  # check formula.R for more details
?model.matrix
?model.response
a <- model.frame(ncases/(ncases+ncontrols) ~ agegp + tobgp + alcgp,
data = esoph, weights = ncases+ncontrols)
dim(esoph)
length(model.response(a))
a
head(a)
?model.frame
source('~/Github/GRAB/R/formula.R')
objFormula = handleFormula(formula, data, subset)  # check formula.R for more details
class(a)
attr(a)
attr(a,1)
?attr
a <- model.frame(ncases/(ncases+ncontrols) ~ agegp + tobgp + alcgp,
data = esoph, weights = ncases+ncontrols)
n = 20
time = runif(n)
event = rbinom(n, 1, 0.5)
x1 = rnorm(n)
x2 = rnorm(n)
x3 = rbinom(n, 2, 0.5)
mf = matrix.frame(event~x1*x2+as.factor(x3))
mf = model.frame(event~x1*x2+as.factor(x3))
dim(mf)
mf
mf = model.frame(event~x1+x2+as.factor(x3))
mf
mf = model.frame(event~x1*x2+as.factor(x3))
mt = attr(x = mf, which = "terms")
response = model.response(mf)
designMat = model.matrix(object = mt, data = mf)
head(designMat)
mt
mf = model.frame(event~x1*x2+as.factor(x3), subset= x2>=(-1))
mt = attr(x = mf, which = "terms")
response = model.response(mf)
designMat = model.matrix(object = mt, data = mf)
response
designMat
mt
mf
?glm
glm
handleFormula = function(formula, data, subset, subjData)  {
cl <- match.call()
mf <- match.call(expand.dots = FALSE)
print(mf)
m <- match(x = c("formula", "data", "subset", "subjData"),
table = names(mf), nomatch = 0L)
print(m)
mf <- mf[c(1L, m)]
mf$drop.unused.levels <- TRUE
mf[[1L]] <- quote(stats::model.frame)
mf <- eval(expr = mf, envir = parent.frame())
print(mf)
mt = attr(x = mf, which = "terms")
response = model.response(mf)
designMat = model.matrix(object = mt, data = mf)
subjData = model.extract(mf, "subjData")
print(response)
print(designMat)
if(colnames(designMat)[1] == "(Intercept)")
designMat = designMat[,-1,drop=F]
return(list(response = response,
designMat = designMat,
subjData = subjData))
}
n = 20
subjData = paste0("abc",1:n)
time = runif(n)
event = rbinom(n, 1, 0.5)
x1 = rnorm(n)
x2 = rnorm(n)
x3 = rbinom(n, 2, 0.5)
a = handleFormula(event ~ x1+x2*x3, subset = x2>0, subjData = subjData)
a$response
a$designMat
a$subjData
n = 20
subjData = paste0("abc",1:(n+1))
time = runif(n)
event = rbinom(n, 1, 0.5)
x1 = rnorm(n)
x2 = rnorm(n)
x3 = rbinom(n, 2, 0.5)
a = handleFormula(event ~ x1+x2*x3, subset = x2>0, subjData = subjData)
remove.packages("GRAB", lib="~/R/win-library/4.0")
library(GRAB)
POLMM_data = read.csv(system.file("extdata", "POLMM_data.csv", package = "GRAB"))
formula  = as.factor(outcome) ~ Cova1 + Cova2
data = POLMM_data
subset = NULL
subjData = data$IID
method = "POLMM"
traitType = "ordinal"
control = NULL
GenoFile = system.file("extdata", "example.bed", package = "GRAB")
objNull = GRAB.NullModel(formula,
data,
subjData = subjData,
method = "SPACox",
traitType = "time-to-event",  # "binary", "ordinal", "quantitative", "time-to-event"
GenoFile = GenoFile)
objNull$subjData
objNull$subjGeno
summary(data)
POLMM_data = read.csv(system.file("extdata", "POLMM_data.csv", package = "GRAB"))
formula  = as.factor(outcome) ~ Cova1 + Cova2
data = POLMM_data
subset = NULL
subjData = data$IID
method = "POLMM"
traitType = "ordinal"
control = NULL
GenoFile = system.file("extdata", "example.bed", package = "GRAB")
objNull = GRAB.NullModel(formula,
data,
subset = Cova1 < (-3),
subjData = subjData,
method = "SPACox",
traitType = "time-to-event",  # "binary", "ordinal", "quantitative", "time-to-event"
GenoFile = GenoFile)
objNull$subjGeno
head(data)
subset = Cova1 < (-3)
objNull = GRAB.NullModel(formula,
data,
subset = Cova1 < (-3),
subjData = subjData,
method = "SPACox",
traitType = "time-to-event",  # "binary", "ordinal", "quantitative", "time-to-event"
GenoFile = GenoFile)
remove.packages("GRAB", lib="~/R/win-library/4.0")
library(GRAB)
POLMM_data = read.csv(system.file("extdata", "POLMM_data.csv", package = "GRAB"))
formula  = as.factor(outcome) ~ Cova1 + Cova2
data = POLMM_data
subset = NULL
subjData = data$IID
method = "POLMM"
traitType = "ordinal"
control = NULL
GenoFile = system.file("extdata", "example.bed", package = "GRAB")
objNull = GRAB.NullModel(formula,
data,
subset = Cova1 < (-3),
subjData = subjData,
method = "SPACox",
traitType = "time-to-event",  # "binary", "ordinal", "quantitative", "time-to-event"
GenoFile = GenoFile)
?glm
objNull = GRAB.NullModel(formula,
data,
subset = data$Cova1 < (-3),
subjData = subjData,
method = "SPACox",
traitType = "time-to-event",  # "binary", "ordinal", "quantitative", "time-to-event"
GenoFile = GenoFile)
objNull$subjGeno
objNull$subjData
?model.frame
x2 = rnorm(n)
n = 20
x2 = rnorm(n)
x2>0
objNull = GRAB.NullModel(formula,
data,
subset = data$Cova1 < (-3),
subjData = subjData,
method = "SPACox",
traitType = "time-to-event",  # "binary", "ordinal", "quantitative", "time-to-event"
GenoFile = GenoFile)
remove.packages("GRAB", lib="~/R/win-library/4.0")
library(GRAB)
POLMM_data = read.csv(system.file("extdata", "POLMM_data.csv", package = "GRAB"))
formula  = as.factor(outcome) ~ Cova1 + Cova2
data = POLMM_data
subset = NULL
subjData = data$IID
method = "POLMM"
traitType = "ordinal"
control = NULL
GenoFile = system.file("extdata", "example.bed", package = "GRAB")
objNull = GRAB.NullModel(formula,
data,
subset = data$Cova1 < (-3),
subjData = subjData,
method = "SPACox",
traitType = "time-to-event",  # "binary", "ordinal", "quantitative", "time-to-event"
GenoFile = GenoFile)
remove.packages("GRAB", lib="~/R/win-library/4.0")
library(GRAB)
POLMM_data = read.csv(system.file("extdata", "POLMM_data.csv", package = "GRAB"))
formula  = as.factor(outcome) ~ Cova1 + Cova2
data = POLMM_data
subset = NULL
subjData = data$IID
method = "POLMM"
traitType = "ordinal"
control = NULL
GenoFile = system.file("extdata", "example.bed", package = "GRAB")
objNull = GRAB.NullModel(formula,
data,
subset = data$Cova1 < (-3),
subjData = subjData,
method = "SPACox",
traitType = "time-to-event",  # "binary", "ordinal", "quantitative", "time-to-event"
GenoFile = GenoFile)
objNull$subjGeno
objNull = GRAB.NullModel(formula,
data,
subset = data$Cova1 < (-3),
subjData = subjData,
method = "SPACox",
traitType = "time-to-event",  # "binary", "ordinal", "quantitative", "time-to-event"
GenoFile = GenoFile)
subset = data$Cova1 < (-3)
GRAB:::handleFormula(formula, data, subset, subjData)
GRAB:::handleFormula(formula, data, subset = data$Cova1 < (-3), subjData)
subset
objNull = GRAB.NullModel(formula,
data,
subset,
subjData = subjData,
method = "SPACox",
traitType = "time-to-event",  # "binary", "ordinal", "quantitative", "time-to-event"
GenoFile = GenoFile)
objNull = GRAB.NullModel(formula,
data,
subset = data$Cova1 < (-3),
subjData = subjData,
method = "SPACox",
traitType = "time-to-event",  # "binary", "ordinal", "quantitative", "time-to-event"
GenoFile = GenoFile)
POLMM_data = read.csv(system.file("extdata", "POLMM_data.csv", package = "GRAB"))
formula  = as.factor(outcome) ~ Cova1 + Cova2
data = POLMM_data
subset = data$Cova1 < (-3)
subjData = data$IID
method = "POLMM"
traitType = "ordinal"
control = NULL
GenoFile = system.file("extdata", "example.bed", package = "GRAB")
# GRAB:::handleFormula(formula, data, subset = data$Cova1 < (-3), subjData)
objNull = GRAB.NullModel(formula,
data,
subset = data$Cova1 < (-3),
subjData = subjData,
method = "SPACox",
traitType = "time-to-event",  # "binary", "ordinal", "quantitative", "time-to-event"
GenoFile = GenoFile)
objNull = GRAB.NullModel(formula,
data,
subset = data$Cova1 < (-2),
subjData = subjData,
method = "SPACox",
traitType = "time-to-event",  # "binary", "ordinal", "quantitative", "time-to-event"
GenoFile = GenoFile)
objNull$subjGeno
subset = NULL
objNull = GRAB.NullModel(formula,
data,
subset = data$Cova1 < (-2),
subjData = subjData,
method = "SPACox",
traitType = "time-to-event",  # "binary", "ordinal", "quantitative", "time-to-event"
GenoFile = GenoFile)
GRAB:::handleFormula(formula, data, subset = data$Cova1 < (-3), subjData)
GRAB:::handleFormula(formula, data, subset = data$Cova1 < (-2), subjData)
remove.packages("GRAB", lib="~/R/win-library/4.0")
library(GRAB)
POLMM_data = read.csv(system.file("extdata", "POLMM_data.csv", package = "GRAB"))
formula  = as.factor(outcome) ~ Cova1 + Cova2
data = POLMM_data
subset = NULL
subjData = data$IID
method = "POLMM"
traitType = "ordinal"
control = NULL
GenoFile = system.file("extdata", "example.bed", package = "GRAB")
GRAB:::handleFormula(formula, data, subset = data$Cova1 < (-2), subjData)
objNull = GRAB.NullModel(formula,
data,
subset = data$Cova1 < (-2),
subjData = subjData,
method = "SPACox",
traitType = "time-to-event",  # "binary", "ordinal", "quantitative", "time-to-event"
GenoFile = GenoFile)
POLMM_data = read.csv(system.file("extdata", "POLMM_data.csv", package = "GRAB"))
formula  = as.factor(outcome) ~ Cova1 + Cova2
data = POLMM_data
subset = NULL
subjData = data$IID
method = "POLMM"
traitType = "ordinal"
control = NULL
GenoFile = system.file("extdata", "example.bed", package = "GRAB")
GRAB:::handleFormula(formula, data, subset = data$Cova1 < (-2), subjData)
objNull = GRAB.NullModel(formula,
data,
subset = data$Cova1 < (-2),
subjData = subjData,
method = "SPACox",
traitType = "time-to-event",  # "binary", "ordinal", "quantitative", "time-to-event"
GenoFile = GenoFile)
remove.packages("GRAB", lib="~/R/win-library/4.0")
library(GRAB)
?handleFormula
n = 20
subjData = paste0("ID-",1:n)
pheno = rbinom(n, 1, 0.5)
x1 = rnorm(n)
x2 = rnorm(n)
x3 = rbinom(n, 2, 0.5)
objFormula = handleFormula(event ~ x1+x2*x3, subset = x2>0, subjData = subjData)
objFormula
library(GRAB)
?handleFormula
n = 20
subjData = paste0("ID-",1:n)
pheno = rbinom(n, 1, 0.5)
x1 = rnorm(n)
x2 = rnorm(n)
x3 = rbinom(n, 2, 0.5)
objFormula = handleFormula(pheno ~ x1+x2*x3, subset = x2>0, subjData = subjData)
objFormula
library(GRAB)
?handleFormula
n = 20
subjData = paste0("ID-",1:n)
pheno = rbinom(n, 1, 0.5)
x1 = rnorm(n)
x2 = rnorm(n)
x3 = rbinom(n, 2, 0.5)
objFormula = handleFormula(pheno ~ x1+x2*x3, subset = x2>0, subjData = subjData)
objFormula
paste0("aa","bb")
library(GRAB)
?seqminer::readPlinkToMatrixByIndex
fileName = system.file("plink/all.anno.filtered.extract.bed", package = "seqminer")
fileName = sub(fileName, pattern = ".bed", replacement = "")
sampleIndex = seq(3)
markerIndex =c(14, 36)
cfh <- readPlinkToMatrixByIndex(fileName, sampleIndex, markerIndex)
libary(seqminer)
install.packages("seqminer")
fileName = system.file("plink/all.anno.filtered.extract.bed", package = "seqminer")
fileName = sub(fileName, pattern = ".bed", replacement = "")
sampleIndex = seq(3)
markerIndex =c(14, 36)
cfh <- readPlinkToMatrixByIndex(fileName, sampleIndex, markerIndex)
libary(seqminer)
library(seqminer)
fileName = system.file("plink/all.anno.filtered.extract.bed", package = "seqminer")
fileName = sub(fileName, pattern = ".bed", replacement = "")
sampleIndex = seq(3)
markerIndex =c(14, 36)
cfh <- readPlinkToMatrixByIndex(fileName, sampleIndex, markerIndex)
dim(cfh)
cfh
library(ordinal)
gcta64File = system.file("gcta_1.93.1beta", "gcta64", package = "POLMM")
system(paste("chmod +x",gcta64File))
system(paste(gcta64File))
gcta64File
?system
Sys.info()['sysname']
system.file("SparseGRM", "temp", package = "POLMM")
library(GRAB)
?getSparseGRM
famFile = system.file("extdata", "nSNPs-10000-nsubj-1000-ext.fam", package = "POLMM")
PlinkFile = gsub(".fam", "", famFile)   # fam/bim/bed files should have the same prefix
nPartsGRM = 2;   # nPartsGRM = 250 for UK Biobank data analysis
tempDir = system.file("SparseGRM", "temp", package = "POLMM")
SparseGRMFile = gsub("temp", "SparseGRM.csv", tempDir)
SparseGRMFile
tempDir
for(partParallel in 1:nPartsGRM){
getTempFilesFullGRM(PlinkFile, nPartsGRM, partParallel)
}
library(GRAB)
library(GRAB)
?GRAB::getSparseGRM
famFile = system.file("extdata", "nSNPs-10000-nsubj-1000-ext.fam", package = "GRAB")
PlinkFile = gsub(".fam", "", famFile)   # fam/bim/bed files should have the same prefix
nPartsGRM = 2;   # nPartsGRM = 250 for UK Biobank data analysis
for(partParallel in 1:nPartsGRM){
getTempFilesFullGRM(PlinkFile, nPartsGRM, partParallel)
}
tempDir = system.file("SparseGRM", "temp", package = "GRAB")
SparseGRMFile = gsub("temp", "SparseGRM.csv", tempDir)
SparseGRM = getSparseGRM(PlinkFile, nPartsGRM, SparseGRMFile)
