Pheno = data.frame(ID = paste0("f",1:N,"_1"),
event=rbinom(N,1,0.5),
time=runif(N),
Cov1=rnorm(N),
Cov2=rbinom(N,1,0.5))
# Step 1: fit a null model
obj.SPACox = GRAB.NullModel(survival::Surv(time,event) ~ Cov1 + Cov2,
data = Pheno, subjData = Pheno$ID, method = "SPACox", traitType = "time-to-event")
library(GRAB)
set.seed(1)
N = 100
Pheno = data.frame(ID = paste0("f",1:N,"_1"),
event=rbinom(N,1,0.5),
time=runif(N),
Cov1=rnorm(N),
Cov2=rbinom(N,1,0.5))
# Step 1: fit a null model
obj.SPACox = GRAB.NullModel(survival::Surv(time,event) ~ Cov1 + Cov2,
data = Pheno, subjData = Pheno$ID, method = "SPACox", traitType = "time-to-event")
obj.SPACox$sessionInfo
obj.SPACox$Call
obj.SPACox$tX
obj.SPACox$mresid
set.seed(1)
N = 100
Pheno = data.frame(ID = paste0("f",1:N,"_1"),
event=rbinom(N,1,0.5),
time=runif(N),
Cov1=rnorm(N),
Cov2=rbinom(N,1,0.5))
# Step 1: fit a null model
obj.SPACox = GRAB.NullModel(survival::Surv(time,event) ~ Cov1 + Cov2,
data = Pheno, subjData = Pheno$ID,
method = "SPACox", traitType = "time-to-event")
NullModelClass = GRAB:::checkObjNull(objNull);
objNull = obj.SPACox
NullModelClass = GRAB:::checkObjNull(objNull);
NullModelClass
?read.table
ï¼Ÿsystem.file
?system.file
library(GRAB)
?GRAB.SPACox
set.seed(1)
N = 100
Pheno = data.frame(ID = paste0("f",1:N,"_1"),
event=rbinom(N,1,0.5),
time=runif(N),
Cov1=rnorm(N),
Cov2=rbinom(N,1,0.5))
# Step 1: fit a null model
obj.SPACox = GRAB.NullModel(survival::Surv(time,event) ~ Cov1 + Cov2,
data = Pheno, subjData = Pheno$ID,
method = "SPACox", traitType = "time-to-event")
Sys.time()
print(paste0("Complete null model fitting: ", objNull$time))
GenoFile = system.file("extdata", "nSNPs-10000-nsubj-1000-ext.bed", package = "GRAB")
OutputDir = system.file("results", package = "GRAB")
OutputFile = paste0(OutputDir, "/SPACoxMarkers.txt")
OutputFile
GeniFile
GenoFile
GRAB.Marker(obj.SPACox, GenoFile = GenoFile,
OutputFile = OutputFile)
library(GRAB)
?GRAB.SPACox
set.seed(1)
N = 100
Pheno = data.frame(ID = paste0("f",1:N,"_1"),
event=rbinom(N,1,0.5),
time=runif(N),
Cov1=rnorm(N),
Cov2=rbinom(N,1,0.5))
# Step 1: fit a null model
obj.SPACox = GRAB.NullModel(survival::Surv(time,event) ~ Cov1 + Cov2,
data = Pheno, subjData = Pheno$ID,
method = "SPACox", traitType = "time-to-event")
# Step 2: run score test
GenoFile = system.file("extdata", "nSNPs-10000-nsubj-1000-ext.bed", package = "GRAB")
OutputDir = system.file("results", package = "GRAB")
OutputFile = paste0(OutputDir, "/SPACoxMarkers.txt")
GRAB.Marker(obj.SPACox, GenoFile = GenoFile,
OutputFile = OutputFile)
control = NULL
objNull = obj.SPACox
NullModelClass = GRAB:::checkObjNull(objNull);         # this function is in 'Util.R'
GRAB:::checkControl.ReadGeno(control)
control = GRAB:::checkControl.Marker(control, NullModelClass)
control
control$nMarkersEachChunk
subjData
subjData = as.character(objNull$subjData);
## set up an object for genotype
objGeno = GRAB:::setGenoInput(GenoFile, GenoFileIndex, subjData)  # this function is in 'Geno.R'
GenoFileIndex = NULL
## set up an object for genotype
objGeno = GRAB:::setGenoInput(GenoFile, GenoFileIndex, subjData)  # this function is in 'Geno.R'
genoType = objGeno$genoType
markerInfo = objGeno$markerInfo
genoType
genoIndex = markerInfo$PositionInPLINK
head(genoIndex)
class(markerInfo)
names(markerInfo)
genoIndex = markerInfo$genoIndex
# all markers were split into multiple chunks,
nMarkersEachChunk = control$nMarkersEachChunk;
genoIndexList = GRAB:::splitMarker(genoIndex, nMarkersEachChunk);
genoIndexList
xx = 100000000000
xx
format(xx, scientific=F)
yy = format(xx, scientific=F)
yy
class(yy)
remove.packages("GRAB", lib="~/R/win-library/4.0")
library(GRAB)
?GRAB.SPACox
set.seed(1)
N = 100
Pheno = data.frame(ID = paste0("f",1:N,"_1"),
event=rbinom(N,1,0.5),
time=runif(N),
Cov1=rnorm(N),
Cov2=rbinom(N,1,0.5))
# Step 1: fit a null model
obj.SPACox = GRAB.NullModel(survival::Surv(time,event) ~ Cov1 + Cov2,
data = Pheno, subjData = Pheno$ID,
method = "SPACox", traitType = "time-to-event")
# Step 2: run score test
GenoFile = system.file("extdata", "nSNPs-10000-nsubj-1000-ext.bed", package = "GRAB")
OutputDir = system.file("results", package = "GRAB")
OutputFile = paste0(OutputDir, "/SPACoxMarkers.txt")
GRAB.Marker(obj.SPACox, GenoFile = GenoFile,
OutputFile = OutputFile)
?GRAB.control
remove.packages("GRAB", lib="~/R/win-library/4.0")
library(GRAB)
set.seed(1)
N = 100
Pheno = data.frame(ID = paste0("f",1:N,"_1"),
event=rbinom(N,1,0.5),
time=runif(N),
Cov1=rnorm(N),
Cov2=rbinom(N,1,0.5))
# Step 1: fit a null model
obj.SPACox = GRAB.NullModel(survival::Surv(time,event) ~ Cov1 + Cov2,
data = Pheno, subjData = Pheno$ID,
method = "SPACox", traitType = "time-to-event")
# Step 2: run score test
GenoFile = system.file("extdata", "nSNPs-10000-nsubj-1000-ext.bed", package = "GRAB")
OutputDir = system.file("results", package = "GRAB")
OutputFile = paste0(OutputDir, "/SPACoxMarkers.txt")
GRAB.Marker(obj.SPACox, GenoFile = GenoFile,
OutputFile = OutputFile)
remove.packages("GRAB", lib="~/R/win-library/4.0")
library(GRAB)
set.seed(1)
N = 100
Pheno = data.frame(ID = paste0("f",1:N,"_1"),
event=rbinom(N,1,0.5),
time=runif(N),
Cov1=rnorm(N),
Cov2=rbinom(N,1,0.5))
# Step 1: fit a null model
obj.SPACox = GRAB.NullModel(survival::Surv(time,event) ~ Cov1 + Cov2,
data = Pheno, subjData = Pheno$ID,
method = "SPACox", traitType = "time-to-event")
# Step 2: run score test
GenoFile = system.file("extdata", "nSNPs-10000-nsubj-1000-ext.bed", package = "GRAB")
OutputDir = system.file("results", package = "GRAB")
OutputFile = paste0(OutputDir, "/SPACoxMarkers.txt")
GRAB.Marker(obj.SPACox, GenoFile = GenoFile,
OutputFile = OutputFile)
remove.packages("GRAB", lib="~/R/win-library/4.0")
library(GRAB)
set.seed(1)
N = 100
Pheno = data.frame(ID = paste0("f",1:N,"_1"),
event=rbinom(N,1,0.5),
time=runif(N),
Cov1=rnorm(N),
Cov2=rbinom(N,1,0.5))
# Step 1: fit a null model
obj.SPACox = GRAB.NullModel(survival::Surv(time,event) ~ Cov1 + Cov2,
data = Pheno, subjData = Pheno$ID,
method = "SPACox", traitType = "time-to-event")
# Step 2: run score test
GenoFile = system.file("extdata", "nSNPs-10000-nsubj-1000-ext.bed", package = "GRAB")
OutputDir = system.file("results", package = "GRAB")
OutputFile = paste0(OutputDir, "/SPACoxMarkers.txt")
GRAB.Marker(obj.SPACox, GenoFile = GenoFile,
OutputFile = OutputFile)
remove.packages("GRAB", lib="~/R/win-library/4.0")
library(GRAB)
set.seed(1)
N = 100
Pheno = data.frame(ID = paste0("f",1:N,"_1"),
event=rbinom(N,1,0.5),
time=runif(N),
Cov1=rnorm(N),
Cov2=rbinom(N,1,0.5))
# Step 1: fit a null model
obj.SPACox = GRAB.NullModel(survival::Surv(time,event) ~ Cov1 + Cov2,
data = Pheno, subjData = Pheno$ID,
method = "SPACox", traitType = "time-to-event")
# Step 2: run score test
GenoFile = system.file("extdata", "nSNPs-10000-nsubj-1000-ext.bed", package = "GRAB")
OutputDir = system.file("results", package = "GRAB")
OutputFile = paste0(OutputDir, "/SPACoxMarkers.txt")
GRAB.Marker(obj.SPACox, GenoFile = GenoFile,
OutputFile = OutputFile)
remove.packages("GRAB", lib="~/R/win-library/4.0")
library(GRAB)
set.seed(1)
N = 100
Pheno = data.frame(ID = paste0("f",1:N,"_1"),
event=rbinom(N,1,0.5),
time=runif(N),
Cov1=rnorm(N),
Cov2=rbinom(N,1,0.5))
# Step 1: fit a null model
obj.SPACox = GRAB.NullModel(survival::Surv(time,event) ~ Cov1 + Cov2,
data = Pheno, subjData = Pheno$ID,
method = "SPACox", traitType = "time-to-event")
# Step 2: run score test
GenoFile = system.file("extdata", "nSNPs-10000-nsubj-1000-ext.bed", package = "GRAB")
OutputDir = system.file("results", package = "GRAB")
OutputFile = paste0(OutputDir, "/SPACoxMarkers.txt")
GRAB.Marker(obj.SPACox, GenoFile = GenoFile,
OutputFile = OutputFile)
GRAB.Marker(obj.SPACox, GenoFile = GenoFile,
OutputFile = OutputFile)
remove.packages("GRAB", lib="~/R/win-library/4.0")
library(GRAB)
set.seed(1)
N = 100
Pheno = data.frame(ID = paste0("f",1:N,"_1"),
event=rbinom(N,1,0.5),
time=runif(N),
Cov1=rnorm(N),
Cov2=rbinom(N,1,0.5))
# Step 1: fit a null model
obj.SPACox = GRAB.NullModel(survival::Surv(time,event) ~ Cov1 + Cov2,
data = Pheno, subjData = Pheno$ID,
method = "SPACox", traitType = "time-to-event")
# Step 2: run score test
GenoFile = system.file("extdata", "nSNPs-10000-nsubj-1000-ext.bed", package = "GRAB")
OutputDir = system.file("results", package = "GRAB")
OutputFile = paste0(OutputDir, "/SPACoxMarkers.txt")
GRAB.Marker(obj.SPACox, GenoFile = GenoFile,
OutputFile = OutputFile)
GRAB.Marker(obj.SPACox, GenoFile = GenoFile,
OutputFile = OutputFile)
remove.packages("GRAB", lib="~/R/win-library/4.0")
library(GRAB)
set.seed(1)
N = 100
Pheno = data.frame(ID = paste0("f",1:N,"_1"),
event=rbinom(N,1,0.5),
time=runif(N),
Cov1=rnorm(N),
Cov2=rbinom(N,1,0.5))
# Step 1: fit a null model
obj.SPACox = GRAB.NullModel(survival::Surv(time,event) ~ Cov1 + Cov2,
data = Pheno, subjData = Pheno$ID,
method = "SPACox", traitType = "time-to-event")
# Step 2: run score test
GenoFile = system.file("extdata", "nSNPs-10000-nsubj-1000-ext.bed", package = "GRAB")
OutputDir = system.file("results", package = "GRAB")
OutputFile = paste0(OutputDir, "/SPACoxMarkers.txt")
GRAB.Marker(obj.SPACox, GenoFile = GenoFile,
OutputFile = OutputFile)
GRAB.Marker(obj.SPACox, GenoFile = GenoFile,
OutputFile = OutputFile)
?GRAB.control
remove.packages("GRAB", lib="~/R/win-library/4.0")
library(GRAB)
set.seed(1)
N = 100
Pheno = data.frame(ID = paste0("f",1:N,"_1"),
event=rbinom(N,1,0.5),
time=runif(N),
Cov1=rnorm(N),
Cov2=rbinom(N,1,0.5))
# Step 1: fit a null model
obj.SPACox = GRAB.NullModel(survival::Surv(time,event) ~ Cov1 + Cov2,
data = Pheno, subjData = Pheno$ID,
method = "SPACox", traitType = "time-to-event")
# Step 2: run score test
GenoFile = system.file("extdata", "nSNPs-10000-nsubj-1000-ext.bed", package = "GRAB")
OutputDir = system.file("results", package = "GRAB")
OutputFile = paste0(OutputDir, "/SPACoxMarkers.txt")
GRAB.Marker(obj.SPACox, GenoFile = GenoFile,
OutputFile = OutputFile)
?GRAB.control
?GRAB.SPACox
remove.packages("GRAB", lib="~/R/win-library/4.0")
library(GRAB)
?GRAB.SPACox
# Simulation phenotype and genotype
set.seed(1)
N = 100
Pheno = data.frame(ID = paste0("f",1:N,"_1"),
event=rbinom(N,1,0.5),
time=runif(N),
Cov1=rnorm(N),
Cov2=rbinom(N,1,0.5))
# Step 1: fit a null model
obj.SPACox = GRAB.NullModel(survival::Surv(time,event) ~ Cov1 + Cov2,
data = Pheno, subjData = Pheno$ID,
method = "SPACox", traitType = "time-to-event")
# Step 2: run score test
GenoFile = system.file("extdata", "nSNPs-10000-nsubj-1000-ext.bed", package = "GRAB")
OutputDir = system.file("results", package = "GRAB")
OutputFile = paste0(OutputDir, "/SPACoxMarkers.txt")
GRAB.Marker(obj.SPACox, GenoFile = GenoFile,
OutputFile = OutputFile)
?GRAB.control
?fwrite
remove.packages("GRAB", lib="~/R/win-library/4.0")
?GRAB.SPACox
library(GRAB)
?GRAB.SPACox
set.seed(1)
N = 100
Pheno = data.frame(ID = paste0("f",1:N,"_1"),
event=rbinom(N,1,0.5),
time=runif(N),
Cov1=rnorm(N),
Cov2=rbinom(N,1,0.5))
# Step 1: fit a null model
obj.SPACox = GRAB.NullModel(survival::Surv(time,event) ~ Cov1 + Cov2,
data = Pheno, subjData = Pheno$ID,
method = "SPACox", traitType = "time-to-event")
# Step 2: run score test
GenoFile = system.file("extdata", "nSNPs-10000-nsubj-1000-ext.bed", package = "GRAB")
OutputDir = system.file("results", package = "GRAB")
OutputFile = paste0(OutputDir, "/SPACoxMarkers.txt")
GRAB.Marker(obj.SPACox, GenoFile = GenoFile,
OutputFile = OutputFile)
Results = data.table::fread('C:/Users/wenji/OneDrive/Documents/R/win-library/4.0/GRAB/results/SPACoxMarkers.txt')
head(Results)
hist(Results$Pval)
library(SPACox)
library(devtools)  # author version: 2.1.0
install_github("WenjianBi/SPACox")
library(SPACox)
install.packages("data.table")
install.packages("data.table")
library(devtools)  # author version: 2.1.0
install_github("WenjianBi/SPACox")
library(SPACox)
?SPACox::SPACox.plink
fam.file = system.file("extdata", "nSNPs-10000-nsubj-1000-ext.fam", package = "GRAB")
fam.data = read.table(fam.file)
obj.null = SPACox_Null_Model(Surv(time,event)~Cov1+Cov2, data=Pheno,
pIDs=Pheno$ID, gIDs=fam.data$V2)
obj.null = SPACox_Null_Model(survival::Surv(time,event)~Cov1+Cov2, data=Pheno,
pIDs=Pheno$ID, gIDs=fam.data$V2)
SPACox.plink(obj.null, plink.file, output.file)
## output is written in output.file
plink.file = gsub("-ext.fam","-ext",fam.file)
output.file = paste0(OutputDir, "/SPACoxMarkers1.txt")
SPACox.plink(obj.null, plink.file, output.file)
Results1 = data.table::fread(output.file)
head(Results1)
head(Results)
dim(fam.data)
84 / 2000
1 / 2000
0.420 - 0.4095
0.445 - 0.4275
(0.445 - 0.4275) * 2000
(0.420 - 0.4095) * 2000
Geno.mtx = seqminer::readPlinkToMatrixByIndex(plink.file, 1:1000, 1:10000)
dim(Geno.mtx)
head(apply(Geno.mtx, 2, mean)/2)
1-head(apply(Geno.mtx, 2, mean)/2)
Geno.mtx[1:10,1:10]
Geno1 = GRAB::GRAB.ReadGeno(plink.file)
plink.file
GenoFile
Geno1 = GRAB::GRAB.ReadGeno(GenoFile)
dim(Geno1)
Geno1$markerInfo
head(Geno1$GenoMat)
apply(Geno1, 2, mean)/2
apply(Geno1$GenoMat, 2, mean)/2
1-head(apply(Geno.mtx, 2, mean)/2)
head(Results)
0.005*200
sort(Results$AltFreq)[1:10]
sort(Results$AltFreq)[1:20]
head(fam.data)
rm(list=ls())
fam.file = system.file("extdata", "nSNPs-10000-nsubj-1000-ext.fam", package = "GRAB")
fam.data = read.table(fam.file)
set.seed(1)
N = 1000
Pheno = data.frame(ID = fam.data$V2,
event=rbinom(N,1,0.5),
time=runif(N),
Cov1=rnorm(N),
Cov2=rbinom(N,1,0.5))
# Step 1: fit a null model
obj.SPACox = GRAB.NullModel(survival::Surv(time,event) ~ Cov1 + Cov2,
data = Pheno, subjData = Pheno$ID,
method = "SPACox", traitType = "time-to-event")
# Step 2: run score test
GenoFile = system.file("extdata", "nSNPs-10000-nsubj-1000-ext.bed", package = "GRAB")
OutputDir = system.file("results", package = "GRAB")
OutputFile = paste0(OutputDir, "/SPACoxMarkers.txt")
GRAB.Marker(obj.SPACox, GenoFile = GenoFile,
OutputFile = OutputFile)
Results = data.table::fread(OutputFile)
hist(Results$Pval)
rm(list=ls())
library(GRAB)
fam.file = system.file("extdata", "nSNPs-10000-nsubj-1000-ext.fam", package = "GRAB")
fam.data = read.table(fam.file)
set.seed(1)
N = 1000
Pheno = data.frame(ID = fam.data$V2,
event=rbinom(N,1,0.5),
time=runif(N),
Cov1=rnorm(N),
Cov2=rbinom(N,1,0.5))
# Step 1: fit a null model
obj.SPACox = GRAB.NullModel(survival::Surv(time,event) ~ Cov1 + Cov2,
data = Pheno, subjData = Pheno$ID,
method = "SPACox", traitType = "time-to-event")
# Step 2: run score test
GenoFile = system.file("extdata", "nSNPs-10000-nsubj-1000-ext.bed", package = "GRAB")
OutputDir = system.file("results", package = "GRAB")
OutputFile = paste0(OutputDir, "/SPACoxMarkers.txt")
GRAB.Marker(obj.SPACox, GenoFile = GenoFile,
OutputFile = OutputFile)
Results = data.table::fread(OutputFile)
hist(Results$Pval)
library(GRAB)
fam.file = system.file("extdata", "nSNPs-10000-nsubj-1000-ext.fam", package = "GRAB")
fam.data = read.table(fam.file)
set.seed(1)
N = 1000
Pheno = data.frame(ID = fam.data$V2,
event=rbinom(N,1,0.5),
time=runif(N),
Cov1=rnorm(N),
Cov2=rbinom(N,1,0.5))
# Step 1: fit a null model
obj.SPACox = GRAB.NullModel(survival::Surv(time,event) ~ Cov1 + Cov2,
data = Pheno, subjData = Pheno$ID,
method = "SPACox", traitType = "time-to-event")
# Step 2: run score test
GenoFile = system.file("extdata", "nSNPs-10000-nsubj-1000-ext.bed", package = "GRAB")
OutputDir = system.file("results", package = "GRAB")
OutputFile = paste0(OutputDir, "/SPACoxMarkers.txt")
GRAB.Marker(obj.SPACox, GenoFile = GenoFile,
OutputFile = OutputFile)
Results = data.table::fread(OutputFile)
hist(Results$Pval)
library(SPACox)
fam.file = system.file("extdata", "nSNPs-10000-nsubj-1000-ext.fam", package = "GRAB")
fam.data = read.table(fam.file)
obj.null = SPACox_Null_Model(survival::Surv(time,event)~Cov1+Cov2, data=Pheno,
pIDs=Pheno$ID, gIDs=fam.data$V2)
## output is written in output.file
plink.file = gsub("-ext.fam","-ext",fam.file)
output.file = paste0(OutputDir, "/SPACoxMarkers1.txt")
SPACox.plink(obj.null, plink.file, output.file)
Results1 = data.table::fread(output.file)
SPACox.plink(obj.null, plink.file, output.file)
Results1 = data.table::fread(output.file)
head(Results1)
head(Results)
remove.packages("GRAB", lib="~/R/win-library/4.0")
library(GRAB)
library(GRAB)
fam.file = system.file("extdata", "nSNPs-10000-nsubj-1000-ext.fam", package = "GRAB")
fam.data = read.table(fam.file)
set.seed(1)
N = 1000
Pheno = data.frame(ID = fam.data$V2,
event=rbinom(N,1,0.5),
time=runif(N),
Cov1=rnorm(N),
Cov2=rbinom(N,1,0.5))
# Step 1: fit a null model
obj.SPACox = GRAB.NullModel(survival::Surv(time,event) ~ Cov1 + Cov2,
data = Pheno, subjData = Pheno$ID,
method = "SPACox", traitType = "time-to-event")
# Step 2: run score test
GenoFile = system.file("extdata", "nSNPs-10000-nsubj-1000-ext.bed", package = "GRAB")
OutputDir = system.file("results", package = "GRAB")
OutputFile = paste0(OutputDir, "/SPACoxMarkers.txt")
GRAB.Marker(obj.SPACox, GenoFile = GenoFile,
OutputFile = OutputFile)
Results = data.table::fread(OutputFile)
library(SPACox)
fam.file = system.file("extdata", "nSNPs-10000-nsubj-1000-ext.fam", package = "GRAB")
fam.data = read.table(fam.file)
obj.null = SPACox_Null_Model(survival::Surv(time,event)~Cov1+Cov2, data=Pheno,
pIDs=Pheno$ID, gIDs=fam.data$V2)
## output is written in output.file
plink.file = gsub("-ext.fam","-ext",fam.file)
output.file = paste0(OutputDir, "/SPACoxMarkers1.txt")
SPACox.plink(obj.null, plink.file, output.file)
Results1 = data.table::fread(output.file)
head(Results)
head(Results1)
remove.packages("GRAB", lib="~/R/win-library/4.0")
